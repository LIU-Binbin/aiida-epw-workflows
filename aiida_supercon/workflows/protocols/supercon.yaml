default_inputs:
  clean_workdir: False
  qfpoints_distance: 0.1
  kfpoints_factor: 2
  epw: &default_epw
    qpoints_distance: 0.5
    kpoints_distance_scf: 0.15
    kpoints_factor_nscf: 2
  # To set for the NSCF step of the Wannier90 work chain
  # One can either use `nscf` mode or `bands` mode. For the `nscf` mode,
  # the `nosym` and `noinv` must be set to True to avoid pw.x automatically
  # adds more (symmetry-equivalent) kpoints to the user-specified kpoints.
  # For the `bands` mode, pw.x will use exactly what the user provided.
  # In addition, it seems epw.x has some problem when restarting from a
  # pw.x calculation with `nosym` and `noinv` set to True, therefore, we
  # switch to the `bands` mode.
    w90_bands:
      nscf:
        pw:
          parameters:
            SYSTEM:
              nosym: False
              noinv: False
            CONTROL:
              calculation: bands
    ph_base:
      ph:
        settings:
          PREPARE_FOR_EPW: True
    epw:
      metadata:
        options:
          resources:
            num_machines: 1
          max_wallclock_seconds: 43200  # Twelve hours
          withmpi: True
          stash:
            source_list:
              - crystal.fmt
              - dmedata.fmt
              - epwdata.fmt
              - selecq.fmt
              - vmedata.fmt
              - aiida.kgmap
              - aiida.kmap
              - aiida.ukk
              - out/aiida.epmatwp
              - save
      parameters:
        INPUTEPW:
          a2f: False
          degaussq: 0.05
          degaussw: 0.2
          elph: True
          epbread: False
          epbwrite: True
          epwread: False
          epwwrite: True
          fsthick: 100
          phonselfen: False
          temps: 300
          vme: 'dipole'
          wannierize: False
  a2f:
    epw: *default_epw
  a2f:
    metadata:
      options:
        resources:
          num_machines: 1
        max_wallclock_seconds: 43200  # Twelve hours
        withmpi: True
    parameters:
      INPUTEPW:
        eliashberg: True
        elph: True
        ep_coupling: True
        epwread: True
        epwwrite: False
        ephwrite: True
        wannierize: False
        muc: 0.13
        mp_mesh_k: True

  iso:
    epw: *default_epw
    iso:
      metadata:
        options:
          resources:
            num_machines: 1
          max_wallclock_seconds: 43200  # Twelve hours
          withmpi: True
      parameters:
        INPUTEPW:
          eliashberg: True
          liso: True
          limag: True
          lpade: False
          laniso: False
          mp_mesh_k: True
          wannierize: False
          tc_linear: True
          tc_linear_solver: 'power'
          muc: 0.13
  
  aniso:
    epw: *default_epw
    aniso:
      metadata:
        options:
          resources:
          num_machines: 1
        max_wallclock_seconds: 43200  # Twelve hours
        withmpi: True
    parameters:
      INPUTEPW:
        eliashberg: True
        laniso: True
        limag: True
        lpade: True
        mp_mesh_k: True
        wannierize: False
        muc: 0.13

default_protocol: moderate
protocols:
  moderate:
    description: 'Protocol to perform a electron-phonon calculation at normal precision at moderate computational cost.'
  precise:
    description: 'Protocol to perform a electron-phonon calculation at high precision at higher computational cost.'
    qfpoints_distance: 0.05
  fast:
    description: 'Protocol to perform a electron-phonon calculation at low precision at minimal computational cost for testing purposes.'
    qfpoints_distance: 0.2
