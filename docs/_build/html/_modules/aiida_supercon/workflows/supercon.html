

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>aiida_supercon.workflows.supercon &mdash; aiida-epw 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=2389946f"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            aiida-epw
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_reference/modules.html">aiida_supercon</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">aiida-epw</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">aiida_supercon.workflows.supercon</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for aiida_supercon.workflows.supercon</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Work chain for computing the critical temperature based off an `EpwWorkChain`.&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aiida</span><span class="w"> </span><span class="kn">import</span> <span class="n">orm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aiida.common</span><span class="w"> </span><span class="kn">import</span> <span class="n">AttributeDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aiida.engine</span><span class="w"> </span><span class="kn">import</span> <span class="n">WorkChain</span><span class="p">,</span> <span class="n">ToContext</span><span class="p">,</span> <span class="n">if_</span><span class="p">,</span> <span class="n">while_</span><span class="p">,</span> <span class="n">append_</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">aiida_quantumespresso.workflows.protocols.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProtocolMixin</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">.b2w</span><span class="w"> </span><span class="kn">import</span> <span class="n">EpwB2WWorkChain</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.bands</span><span class="w"> </span><span class="kn">import</span> <span class="n">EpwBandsWorkChain</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.a2f</span><span class="w"> </span><span class="kn">import</span> <span class="n">EpwA2fWorkChain</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.iso</span><span class="w"> </span><span class="kn">import</span> <span class="n">EpwIsoWorkChain</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.aniso</span><span class="w"> </span><span class="kn">import</span> <span class="n">EpwAnisoWorkChain</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">EpwBaseWorkChain</span>

<div class="viewcode-block" id="EpwSuperConWorkChain">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EpwSuperConWorkChain</span><span class="p">(</span><span class="n">ProtocolMixin</span><span class="p">,</span> <span class="n">WorkChain</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Work chain to compute superconductivity based on different levels of approximations.</span>
<span class="sd">    It will run the  `EpwBandsWorkChain`, `EpwA2fWorkChain`, `EpwIsoWorkChain`, and `EpwAnisoWorkChain` consecutively.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">_NAMESPACE</span> <span class="o">=</span> <span class="s1">&#39;supercon&#39;</span>

    <span class="n">_CONV_NAMESPACE</span> <span class="o">=</span> <span class="s1">&#39;a2f_conv&#39;</span>

    <span class="n">_B2W_NAMESPACE</span> <span class="o">=</span> <span class="n">EpwB2WWorkChain</span><span class="o">.</span><span class="n">_NAMESPACE</span>
    <span class="n">_BANDS_NAMESPACE</span> <span class="o">=</span> <span class="n">EpwBandsWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span>
    <span class="n">_A2F_NAMESPACE</span> <span class="o">=</span> <span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span>
    <span class="n">_ISO_NAMESPACE</span> <span class="o">=</span> <span class="n">EpwIsoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span>
    <span class="n">_ANISO_NAMESPACE</span> <span class="o">=</span> <span class="n">EpwAnisoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span>

    <span class="n">_blocked_keywords</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;INPUTEPW&#39;</span><span class="p">,</span> <span class="s1">&#39;use_ws&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;INPUTEPW&#39;</span><span class="p">,</span> <span class="s1">&#39;muc&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;INPUTEPW&#39;</span><span class="p">,</span> <span class="s1">&#39;nbndsub&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;INPUTEPW&#39;</span><span class="p">,</span> <span class="s1">&#39;bands_skipped&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;INPUTEPW&#39;</span><span class="p">,</span> <span class="s1">&#39;vme&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">_restart_from_ephmat</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;INPUTEPW&#39;</span><span class="p">:</span> <span class="p">(</span>
            <span class="p">(</span><span class="s1">&#39;elph&#39;</span><span class="p">,</span>        <span class="kc">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;ep_coupling&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;ephwrite&#39;</span><span class="p">,</span>    <span class="kc">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;restart&#39;</span><span class="p">,</span>     <span class="kc">True</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">}</span>

<div class="viewcode-block" id="EpwSuperConWorkChain.define">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.define">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">define</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define the work chain specification.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

        <span class="n">spec</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s1">&#39;clean_workdir&#39;</span><span class="p">,</span> <span class="n">valid_type</span><span class="o">=</span><span class="n">orm</span><span class="o">.</span><span class="n">Bool</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">orm</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s1">&#39;structure&#39;</span><span class="p">,</span> <span class="n">valid_type</span><span class="o">=</span><span class="n">orm</span><span class="o">.</span><span class="n">StructureData</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s1">&#39;interpolation_distances&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">valid_type</span><span class="o">=</span><span class="n">orm</span><span class="o">.</span><span class="n">List</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s1">&#39;convergence_threshold&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">valid_type</span><span class="o">=</span><span class="n">orm</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s1">&#39;always_run_final&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">valid_type</span><span class="o">=</span><span class="n">orm</span><span class="o">.</span><span class="n">Bool</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">orm</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>

        <span class="n">spec</span><span class="o">.</span><span class="n">expose_inputs</span><span class="p">(</span>
            <span class="n">EpwB2WWorkChain</span><span class="p">,</span>
            <span class="n">namespace</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">,</span>
            <span class="n">exclude</span><span class="o">=</span><span class="p">(</span>
                <span class="s1">&#39;clean_workdir&#39;</span><span class="p">,</span>
                <span class="s1">&#39;structure&#39;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">namespace_options</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;populate_defaults&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Inputs for the `EpwB2WWorkChain`.&#39;</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">spec</span><span class="o">.</span><span class="n">expose_inputs</span><span class="p">(</span>
            <span class="n">EpwBandsWorkChain</span><span class="p">,</span>
            <span class="n">namespace</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_BANDS_NAMESPACE</span><span class="p">,</span>
            <span class="n">exclude</span><span class="o">=</span><span class="p">(</span>
                <span class="s1">&#39;clean_workdir&#39;</span><span class="p">,</span>
                <span class="s1">&#39;structure&#39;</span><span class="p">,</span>
                <span class="s1">&#39;parent_folder_epw&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_BANDS_NAMESPACE</span><span class="si">}</span><span class="s1">.parent_folder_nscf&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_BANDS_NAMESPACE</span><span class="si">}</span><span class="s1">.parent_folder_chk&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_BANDS_NAMESPACE</span><span class="si">}</span><span class="s1">.parent_folder_ph&#39;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">namespace_options</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;populate_defaults&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Inputs for the `EpwBandsWorkChain`.&#39;</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># Here A2f and A2f_conv are exclusive, they share the same namespace</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">expose_inputs</span><span class="p">(</span>
            <span class="n">EpwA2fWorkChain</span><span class="p">,</span>
            <span class="n">namespace</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_A2F_NAMESPACE</span><span class="p">,</span>
            <span class="n">exclude</span><span class="o">=</span><span class="p">(</span>
                <span class="s1">&#39;clean_workdir&#39;</span><span class="p">,</span>
                <span class="s1">&#39;structure&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_A2F_NAMESPACE</span><span class="si">}</span><span class="s1">.parent_folder_nscf&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_A2F_NAMESPACE</span><span class="si">}</span><span class="s1">.parent_folder_chk&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_A2F_NAMESPACE</span><span class="si">}</span><span class="s1">.parent_folder_ph&#39;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">namespace_options</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;populate_defaults&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Inputs for the `EpwA2fWorkChain`.&#39;</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">expose_inputs</span><span class="p">(</span>
            <span class="n">EpwIsoWorkChain</span><span class="p">,</span>
            <span class="n">namespace</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span><span class="p">,</span>
            <span class="n">exclude</span><span class="o">=</span><span class="p">(</span>
                <span class="s1">&#39;clean_workdir&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span><span class="si">}</span><span class="s2">.parent_folder_nscf&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span><span class="si">}</span><span class="s2">.parent_folder_chk&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span><span class="si">}</span><span class="s2">.parent_folder_ph&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">namespace_options</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;populate_defaults&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Inputs for the `EpwIsoWorkChain`.&#39;</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">expose_inputs</span><span class="p">(</span>
            <span class="n">EpwAnisoWorkChain</span><span class="p">,</span>
            <span class="n">namespace</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ANISO_NAMESPACE</span><span class="p">,</span>
            <span class="n">exclude</span><span class="o">=</span><span class="p">(</span>
                <span class="s1">&#39;clean_workdir&#39;</span><span class="p">,</span>
                <span class="s1">&#39;structure&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ANISO_NAMESPACE</span><span class="si">}</span><span class="s2">.parent_folder_nscf&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ANISO_NAMESPACE</span><span class="si">}</span><span class="s2">.parent_folder_chk&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ANISO_NAMESPACE</span><span class="si">}</span><span class="s2">.parent_folder_ph&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">namespace_options</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;populate_defaults&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Inputs for the `EpwAnisoWorkChain`.&#39;</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">outline</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">setup</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">validate_inputs</span><span class="p">,</span>
            <span class="n">if_</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">should_run_b2w</span><span class="p">)(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">run_b2w</span><span class="p">,</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">inspect_b2w</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">if_</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">should_run_bands</span><span class="p">)(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">run_bands</span><span class="p">,</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">inspect_bands</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">prepare_intp</span><span class="p">,</span>
            <span class="n">while_</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">should_run_conv</span><span class="p">)(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">run_conv</span><span class="p">,</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">inspect_conv</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">if_</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">should_run_a2f</span><span class="p">)(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">run_a2f</span><span class="p">,</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">inspect_a2f</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">if_</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">should_run_iso</span><span class="p">)(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">run_iso</span><span class="p">,</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">inspect_iso</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">if_</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">should_run_aniso</span><span class="p">)(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">run_aniso</span><span class="p">,</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">inspect_aniso</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">results</span>
        <span class="p">)</span>
        <span class="c1"># spec.output(&#39;parameters&#39;, valid_type=orm.Dict,</span>
        <span class="c1">#             help=&#39;The `output_parameters` output node of the final EPW calculation.&#39;)</span>
        <span class="c1"># spec.output(&#39;Tc_allen_dynes&#39;, valid_type=orm.Float, required=False,</span>
        <span class="c1">#             help=&#39;The Allen-Dynes Tc interpolated from the a2f file.&#39;)</span>
        <span class="c1"># spec.output(&#39;Tc_iso&#39;, valid_type=orm.Float, required=False,</span>
        <span class="c1">#             help=&#39;The isotropic linearised Eliashberg Tc interpolated from the max eigenvalue curve.&#39;)</span>
        <span class="c1"># spec.output(&#39;Tc_aniso&#39;, valid_type=orm.Float, required=False,</span>
        <span class="c1">#             help=&#39;The anisotropic Eliashberg Tc interpolated from the max eigenvalue curve.&#39;)</span>

        <span class="n">spec</span><span class="o">.</span><span class="n">expose_outputs</span><span class="p">(</span>
            <span class="n">EpwB2WWorkChain</span><span class="p">,</span>
            <span class="n">namespace</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">,</span>
            <span class="n">namespace_options</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Outputs from the anisotropic `EpwCalculation`.&#39;</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">spec</span><span class="o">.</span><span class="n">expose_outputs</span><span class="p">(</span>
            <span class="n">EpwBandsWorkChain</span><span class="p">,</span>
            <span class="n">namespace</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_BANDS_NAMESPACE</span><span class="p">,</span>
            <span class="n">namespace_options</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Outputs from the `EpwBandsWorkChain`.&#39;</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">expose_outputs</span><span class="p">(</span>
            <span class="n">EpwA2fWorkChain</span><span class="p">,</span>
            <span class="n">namespace</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_A2F_NAMESPACE</span><span class="p">,</span>
            <span class="n">namespace_options</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Outputs from the `EpwA2fWorkChain`.&#39;</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">spec</span><span class="o">.</span><span class="n">expose_outputs</span><span class="p">(</span>
            <span class="n">EpwIsoWorkChain</span><span class="p">,</span>
            <span class="n">namespace</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span><span class="p">,</span>
            <span class="n">exclude</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;dos&#39;</span><span class="p">,</span> <span class="s1">&#39;phdos&#39;</span><span class="p">,</span> <span class="s1">&#39;phdos_proj&#39;</span><span class="p">,</span> <span class="s1">&#39;a2f&#39;</span><span class="p">,</span> <span class="s1">&#39;a2f_proj&#39;</span><span class="p">,</span> <span class="s1">&#39;lambda_FS&#39;</span><span class="p">,</span> <span class="s1">&#39;lambda_k_pairs&#39;</span><span class="p">),</span>
            <span class="n">namespace_options</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Outputs from the `EpwIsoWorkChain`.&#39;</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">spec</span><span class="o">.</span><span class="n">expose_outputs</span><span class="p">(</span>
            <span class="n">EpwAnisoWorkChain</span><span class="p">,</span>
            <span class="n">namespace</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ANISO_NAMESPACE</span><span class="p">,</span>
            <span class="n">exclude</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;dos&#39;</span><span class="p">,</span> <span class="s1">&#39;phdos&#39;</span><span class="p">,</span> <span class="s1">&#39;phdos_proj&#39;</span><span class="p">,</span> <span class="s1">&#39;a2f&#39;</span><span class="p">,</span> <span class="s1">&#39;a2f_proj&#39;</span><span class="p">,</span> <span class="s1">&#39;lambda_FS&#39;</span><span class="p">,</span> <span class="s1">&#39;lambda_k_pairs&#39;</span><span class="p">),</span>
            <span class="n">namespace_options</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Outputs from the `EpwAnisoWorkChain`.&#39;</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">spec</span><span class="o">.</span><span class="n">exit_code</span><span class="p">(</span><span class="mi">401</span><span class="p">,</span> <span class="s1">&#39;ERROR_SUB_PROCESS_B2W&#39;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s1">&#39;The `b2w` sub process failed&#39;</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">exit_code</span><span class="p">(</span><span class="mi">402</span><span class="p">,</span> <span class="s1">&#39;ERROR_CONVERGENCE_NOT_REACHED&#39;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s1">&#39;The convergence is not reached in current interpolation list.&#39;</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">exit_code</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s1">&#39;ERROR_SUB_PROCESS_BANDS&#39;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s1">&#39;The `bands` sub process failed&#39;</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">exit_code</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s1">&#39;ERROR_SUB_PROCESS_A2F&#39;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s1">&#39;The `a2f` sub process failed&#39;</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">exit_code</span><span class="p">(</span><span class="mi">405</span><span class="p">,</span> <span class="s1">&#39;ERROR_Allen_Dynes_Tc_TOO_LOW&#39;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s1">&#39;The Allen-Dynes Tc is too low.&#39;</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">exit_code</span><span class="p">(</span><span class="mi">406</span><span class="p">,</span> <span class="s1">&#39;ERROR_SUB_PROCESS_ISO&#39;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s1">&#39;The `iso` sub process failed&#39;</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">exit_code</span><span class="p">(</span><span class="mi">407</span><span class="p">,</span> <span class="s1">&#39;ERROR_ISOTROPIC_TC_TOO_LOW&#39;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s1">&#39;The isotropic Tc is too low.&#39;</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">exit_code</span><span class="p">(</span><span class="mi">408</span><span class="p">,</span> <span class="s1">&#39;ERROR_SUB_PROCESS_ANISO&#39;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s1">&#39;The `aniso` sub process failed&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.get_protocol_filepath">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.get_protocol_filepath">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_protocol_filepath</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return ``pathlib.Path`` to the ``.yaml`` file that defines the protocols.&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">importlib_resources</span><span class="w"> </span><span class="kn">import</span> <span class="n">files</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">protocols</span>
        <span class="k">return</span> <span class="n">files</span><span class="p">(</span><span class="n">protocols</span><span class="p">)</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_NAMESPACE</span><span class="si">}</span><span class="s1">.yaml&#39;</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.get_descendant">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.get_descendant">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_descendant</span><span class="p">(</span>
        <span class="n">supercon</span><span class="p">:</span> <span class="n">orm</span><span class="o">.</span><span class="n">WorkChainNode</span><span class="p">,</span>
        <span class="n">link_label_filter</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">orm</span><span class="o">.</span><span class="n">WorkChainNode</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the descendant workchains of the intp workchain.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">supercon</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">get_outgoing</span><span class="p">(</span>
                <span class="n">link_label_filter</span><span class="o">=</span><span class="n">link_label_filter</span>
                <span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">node</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.get_descendants">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.get_descendants">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_descendants</span><span class="p">(</span>
        <span class="n">supercon</span><span class="p">:</span> <span class="n">orm</span><span class="o">.</span><span class="n">WorkChainNode</span><span class="p">,</span>
        <span class="n">link_label_filter</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">orm</span><span class="o">.</span><span class="n">WorkChainNode</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the descendant workchains of the intp workchain.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">supercon</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">get_outgoing</span><span class="p">(</span>
                <span class="n">link_label_filter</span><span class="o">=</span><span class="n">link_label_filter</span>
                <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.get_builder_restart_from_b2w">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.get_builder_restart_from_b2w">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_builder_restart_from_b2w</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">from_b2w_workchain</span><span class="p">:</span> <span class="n">orm</span><span class="o">.</span><span class="n">WorkChainNode</span><span class="p">,</span>
        <span class="n">protocol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">overrides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a builder prepopulated with inputs selected according to the chosen protocol.&quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_protocol_inputs</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">overrides</span><span class="p">)</span>

        <span class="n">builder</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_builder</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">from_b2w_workchain</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">from_b2w_workchain</span><span class="o">.</span><span class="n">process_class</span> <span class="o">==</span> <span class="n">EpwB2WWorkChain</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Currently we only accept `EpwB2WWorkChain`&#39;</span><span class="p">)</span>

        <span class="c1"># b2w_parameters = from_b2w_workchain.inputs.epw.parameters.get_dict()</span>

        <span class="c1"># parameters = builder.epw.parameters.get_dict()</span>

        <span class="c1"># for namespace, keyword in cls._blocked_keywords:</span>
        <span class="c1">#     if keyword in b2w_parameters[namespace]:</span>
        <span class="c1">#         parameters[namespace][keyword] = b2w_parameters[namespace][keyword]</span>
        <span class="k">if</span> <span class="n">from_b2w_workchain</span><span class="o">.</span><span class="n">is_finished_ok</span><span class="p">:</span>
            <span class="n">builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">)</span>
            <span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">from_b2w_workchain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">epw</span><span class="o">.</span><span class="n">remote_folder</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">b2w_builder</span> <span class="o">=</span> <span class="n">EpwB2WWorkChain</span><span class="o">.</span><span class="n">get_builder_restart</span><span class="p">(</span>
                <span class="n">from_b2w_workchain</span><span class="o">=</span><span class="n">from_b2w_workchain</span><span class="p">,</span>
                <span class="n">protocol</span><span class="o">=</span><span class="n">protocol</span><span class="p">,</span>
                <span class="n">overrides</span><span class="o">=</span><span class="n">overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>

            <span class="c1"># Actually there is no exclusion of EpwB2WWorkChain namespace</span>
            <span class="c1"># So we need to set the _data manually</span>
            <span class="n">builder</span><span class="p">[</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">b2w_builder</span><span class="o">.</span><span class="n">_data</span>


        <span class="k">for</span> <span class="p">(</span><span class="n">epw_namespace</span><span class="p">,</span> <span class="n">epw_workchain_class</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">,</span> <span class="n">EpwA2fWorkChain</span><span class="p">),</span>
            <span class="p">(</span><span class="n">EpwIsoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">,</span> <span class="n">EpwIsoWorkChain</span><span class="p">),</span>
            <span class="p">(</span><span class="n">EpwAnisoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">,</span> <span class="n">EpwAnisoWorkChain</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="n">epw_builder</span> <span class="o">=</span> <span class="n">epw_workchain_class</span><span class="o">.</span><span class="n">get_builder_restart_from_b2w</span><span class="p">(</span>
                <span class="n">from_b2w_workchain</span><span class="o">=</span><span class="n">from_b2w_workchain</span><span class="p">,</span>
                <span class="n">protocol</span><span class="o">=</span><span class="n">protocol</span><span class="p">,</span>
                <span class="n">overrides</span><span class="o">=</span><span class="n">overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">epw_namespace</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">epw_workchain_class</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span> <span class="ow">in</span> <span class="n">epw_builder</span><span class="p">:</span>
                <span class="n">epw_builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">epw_workchain_class</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">)</span>

            <span class="n">builder</span><span class="p">[</span><span class="n">epw_namespace</span><span class="p">]</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">epw_builder</span><span class="o">.</span><span class="n">_data</span>

        <span class="k">if</span> <span class="n">parent_folder_epw</span><span class="p">:</span>
            <span class="n">builder</span><span class="p">[</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">parent_folder_epw</span>

        <span class="n">builder</span><span class="o">.</span><span class="n">interpolation_distances</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interpolation_distances&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">convergence_threshold</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;convergence_threshold&#39;</span><span class="p">])</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">always_run_final</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;always_run_final&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">clean_workdir</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;clean_workdir&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">builder</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.get_builder_from_a2f">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.get_builder_from_a2f">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_builder_from_a2f</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">from_a2f_workchain</span><span class="p">:</span> <span class="n">orm</span><span class="o">.</span><span class="n">WorkChainNode</span><span class="p">,</span>
        <span class="n">protocol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">overrides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a builder prepopulated with inputs selected according to the chosen protocol.&quot;&quot;&quot;</span>

        <span class="n">builder</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_builder</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">from_a2f_workchain</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">from_a2f_workchain</span><span class="o">.</span><span class="n">process_class</span> <span class="o">==</span> <span class="n">EpwA2fWorkChain</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Currently we only accept `EpwA2fWorkChain`&#39;</span><span class="p">)</span>

        <span class="n">structure</span> <span class="o">=</span> <span class="n">from_a2f_workchain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">from_a2f_workchain</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">epw</span><span class="o">.</span><span class="n">code</span>

        <span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">from_a2f_workchain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">epw</span><span class="o">.</span><span class="n">remote_folder</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">epw_namespace</span><span class="p">,</span> <span class="n">epw_workchain_class</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">EpwIsoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">,</span> <span class="n">EpwIsoWorkChain</span><span class="p">),</span>
            <span class="p">(</span><span class="n">EpwAnisoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">,</span> <span class="n">EpwAnisoWorkChain</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="n">epw_builder</span> <span class="o">=</span> <span class="n">epw_workchain_class</span><span class="o">.</span><span class="n">get_builder</span><span class="p">()</span>

            <span class="n">intp_builder</span> <span class="o">=</span> <span class="n">EpwBaseWorkChain</span><span class="o">.</span><span class="n">get_builder_from_protocol</span><span class="p">(</span>
                <span class="n">code</span><span class="p">,</span>
                <span class="n">structure</span><span class="p">,</span>
                <span class="n">protocol</span><span class="p">,</span>
                <span class="n">overrides</span><span class="o">=</span><span class="n">overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">epw_namespace</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="n">epw_builder</span><span class="p">[</span><span class="n">epw_workchain_class</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">intp_builder</span><span class="o">.</span><span class="n">_data</span>

            <span class="n">epw_builder</span><span class="p">[</span><span class="n">epw_workchain_class</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">parent_folder_epw</span>

            <span class="n">builder</span><span class="p">[</span><span class="n">epw_namespace</span><span class="p">]</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">epw_builder</span><span class="o">.</span><span class="n">_data</span>

        <span class="n">builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;interpolation_distances&#39;</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;convergence_threshold&#39;</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;always_run_final&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">builder</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.get_builder_restart">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.get_builder_restart">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_builder_restart</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">from_supercon_workchain</span><span class="p">:</span> <span class="n">orm</span><span class="o">.</span><span class="n">WorkChainNode</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">from_supercon_workchain</span><span class="o">.</span><span class="n">get_builder_restart</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">from_supercon_workchain</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">from_supercon_workchain</span><span class="o">.</span><span class="n">process_class</span> <span class="o">==</span> <span class="n">EpwSuperConWorkChain</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Currently we only accept `EpwSuperConWorkChain`&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">from_supercon_workchain</span><span class="o">.</span><span class="n">is_finished_ok</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;The `EpwSuperConWorkChain` is already finished.&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sub_workchain</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="n">EpwA2fWorkChain</span><span class="p">,</span>
                <span class="n">EpwIsoWorkChain</span><span class="p">,</span>
                <span class="n">EpwAnisoWorkChain</span><span class="p">,</span>
                <span class="p">):</span>
                <span class="n">builder</span><span class="p">[</span><span class="n">sub_workchain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">sub_workchain</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Firstly we should check whether we should restart from b2w workchain.</span>
        <span class="k">if</span> <span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span> <span class="ow">in</span> <span class="n">from_supercon_workchain</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="n">b2w_workchain</span> <span class="o">=</span> <span class="n">EpwSuperConWorkChain</span><span class="o">.</span><span class="n">get_descendant</span><span class="p">(</span>
                <span class="n">from_supercon_workchain</span><span class="p">,</span>
                <span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span>
                <span class="p">)</span>
                <span class="c1"># If the b2w workchain is finished, simply pop it.</span>
            <span class="k">if</span> <span class="n">b2w_workchain</span><span class="o">.</span><span class="n">is_finished_ok</span><span class="p">:</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">)</span>
                <span class="n">builder</span><span class="p">[</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">][</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">b2w_workchain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">epw</span><span class="o">.</span><span class="n">remote_folder</span>
            <span class="c1"># If the b2w workchain is not finished, we only need to restart from b2w workchain leaving the following inputs unchanged.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b2w_builder</span> <span class="o">=</span> <span class="n">EpwB2WWorkChain</span><span class="o">.</span><span class="n">get_builder_restart</span><span class="p">(</span>
                    <span class="n">from_b2w_workchain</span><span class="o">=</span><span class="n">b2w_workchain</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="n">builder</span><span class="p">[</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">b2w_builder</span><span class="o">.</span><span class="n">_data</span>

                <span class="k">return</span> <span class="n">builder</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">)</span>

        <span class="c1"># If interpolation list is not an input port, it must be that the previous</span>
        <span class="c1"># workchain has finished convergence test. Or it start from a given grid without convergence test.</span>

        <span class="k">if</span> <span class="s1">&#39;interpolation_distances&#39;</span> <span class="ow">in</span> <span class="n">from_supercon_workchain</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="n">initial_interpolation_distances</span> <span class="o">=</span> <span class="n">from_supercon_workchain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">interpolation_distances</span><span class="o">.</span><span class="n">get_list</span><span class="p">()</span>
            <span class="c1"># Then we need to know whether convergence is finished.</span>
            <span class="n">a2f_conv_workchains</span> <span class="o">=</span> <span class="n">EpwSuperConWorkChain</span><span class="o">.</span><span class="n">get_descendants</span><span class="p">(</span>
                <span class="n">from_supercon_workchain</span><span class="p">,</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_CONV_NAMESPACE</span>
                <span class="p">)</span>

            <span class="k">for</span> <span class="n">a2f_conv_workchain</span> <span class="ow">in</span> <span class="n">a2f_conv_workchains</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">a2f_conv_workchain</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">is_finished_ok</span><span class="p">:</span>
                    <span class="n">initial_interpolation_distances</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">a2f_conv_workchain</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">a2f</span><span class="o">.</span><span class="n">qfpoints_distance</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_interpolation_distances</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">builder</span><span class="p">[</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">][</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">a2f_conv_workchains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">interpolation_distances</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">initial_interpolation_distances</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">builder</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">builder</span><span class="p">[</span><span class="n">EpwIsoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">][</span><span class="n">EpwIsoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">a2f_conv_workchains</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">remote_folder</span>

                <span class="n">builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">)</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;interpolation_distances&#39;</span><span class="p">)</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;convergence_threshold&#39;</span><span class="p">)</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;always_run_final&#39;</span><span class="p">)</span>

        <span class="c1"># If there is no interpolation distance, either it&#39;s finished or we don&#39;t do it at all.</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span> <span class="ow">in</span> <span class="n">from_supercon_workchain</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
                <span class="n">a2f_workchain</span> <span class="o">=</span> <span class="n">EpwSuperConWorkChain</span><span class="o">.</span><span class="n">get_descendant</span><span class="p">(</span>
                    <span class="n">from_supercon_workchain</span><span class="p">,</span>
                    <span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">a2f_workchain</span> <span class="ow">and</span> <span class="n">a2f_workchain</span><span class="o">.</span><span class="n">is_finished_ok</span><span class="p">:</span>
                    <span class="n">builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">)</span>
                    <span class="n">builder</span><span class="p">[</span><span class="n">EpwIsoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">][</span><span class="n">EpwIsoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">a2f_workchain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">parent_folder_epw</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">a2f_builder</span> <span class="o">=</span> <span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">get_builder_restart</span><span class="p">(</span>
                        <span class="n">from_a2f_workchain</span><span class="o">=</span><span class="n">a2f_workchain</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">a2f_builder</span><span class="o">.</span><span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">a2f_workchain</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span>
                    <span class="n">builder</span><span class="p">[</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">a2f_builder</span><span class="o">.</span><span class="n">_data</span>
                    <span class="k">return</span> <span class="n">builder</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">EpwIsoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span> <span class="ow">in</span> <span class="n">from_supercon_workchain</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="n">iso_workchain</span> <span class="o">=</span> <span class="n">EpwSuperConWorkChain</span><span class="o">.</span><span class="n">get_descendant</span><span class="p">(</span>
                <span class="n">from_supercon_workchain</span><span class="p">,</span>
                <span class="n">EpwIsoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">iso_workchain</span> <span class="ow">and</span> <span class="n">iso_workchain</span><span class="o">.</span><span class="n">is_finished_ok</span><span class="p">:</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">EpwIsoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">iso_workchain</span><span class="p">:</span>
                <span class="n">iso_builder</span> <span class="o">=</span> <span class="n">EpwIsoWorkChain</span><span class="o">.</span><span class="n">get_builder_restart</span><span class="p">(</span>
                    <span class="n">from_iso_workchain</span><span class="o">=</span><span class="n">iso_workchain</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># builder[EpwIsoWorkChain._INTP_NAMESPACE][EpwIsoWorkChain._INTP_NAMESPACE].parent_folder_epw = iso_workchain.inputs[EpwIsoWorkChain._INTP_NAMESPACE].parent_folder_epw</span>
                <span class="n">builder</span><span class="p">[</span><span class="n">EpwIsoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">iso_builder</span><span class="o">.</span><span class="n">_data</span>
                <span class="k">return</span> <span class="n">builder</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">builder</span><span class="p">[</span><span class="n">EpwIsoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">iso_workchain</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">EpwIsoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span>
                <span class="k">return</span> <span class="n">builder</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">EpwIsoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">EpwAnisoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span> <span class="ow">in</span> <span class="n">from_supercon_workchain</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="n">aniso_workchain</span> <span class="o">=</span> <span class="n">EpwSuperConWorkChain</span><span class="o">.</span><span class="n">get_descendant</span><span class="p">(</span>
                <span class="n">from_supercon_workchain</span><span class="p">,</span>
                <span class="n">EpwAnisoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">aniso_workchain</span> <span class="ow">and</span> <span class="n">aniso_workchain</span><span class="o">.</span><span class="n">is_finished_ok</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;The `EpwSuperConWorkChain` has already finished.&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">aniso_workchain</span><span class="p">:</span>
                <span class="n">aniso_builder</span> <span class="o">=</span> <span class="n">EpwAnisoWorkChain</span><span class="o">.</span><span class="n">get_builder_restart</span><span class="p">(</span>
                    <span class="n">from_aniso_workchain</span><span class="o">=</span><span class="n">aniso_workchain</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">builder</span><span class="p">[</span><span class="n">EpwAnisoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">aniso_builder</span><span class="o">.</span><span class="n">_data</span>
                <span class="k">return</span> <span class="n">builder</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">builder</span><span class="p">[</span><span class="n">EpwAnisoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">][</span><span class="n">EpwAnisoWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">iso_workchain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">remote_folder</span>
                <span class="k">return</span> <span class="n">builder</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;The `EpwSuperConWorkChain` has already finished.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.get_builder_restart_from_ph">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.get_builder_restart_from_ph">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_builder_restart_from_ph</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">from_ph_workchain</span><span class="p">:</span> <span class="n">orm</span><span class="o">.</span><span class="n">WorkChainNode</span><span class="p">,</span>
            <span class="n">codes</span><span class="p">,</span>
            <span class="n">protocol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">overrides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a builder prepopulated with inputs selected according to the chosen protocol.</span>

<span class="sd">        :TODO:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">structure</span> <span class="o">=</span> <span class="n">from_ph_workchain</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">ph</span><span class="o">.</span><span class="n">parent_folder</span><span class="o">.</span><span class="n">creator</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">structure</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_protocol_inputs</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">overrides</span><span class="p">)</span>

        <span class="n">b2w_builder</span> <span class="o">=</span> <span class="n">EpwB2WWorkChain</span><span class="o">.</span><span class="n">get_builder_restart_from_phonon</span><span class="p">(</span>
            <span class="n">from_ph_workchain</span><span class="o">=</span><span class="n">from_ph_workchain</span><span class="p">,</span>
            <span class="n">codes</span><span class="o">=</span><span class="n">codes</span><span class="p">,</span>
            <span class="n">protocol</span><span class="o">=</span><span class="n">protocol</span><span class="p">,</span>
            <span class="n">overrides</span><span class="o">=</span><span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="c1"># b2w_builder.w90_intp.pop(&#39;open_grid&#39;)</span>
        <span class="c1"># b2w_builder.w90_intp.pop(&#39;projwfc&#39;)</span>

        <span class="n">builder</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_builder_from_protocol</span><span class="p">(</span>
            <span class="n">codes</span><span class="o">=</span><span class="n">codes</span><span class="p">,</span>
            <span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">,</span>
            <span class="n">protocol</span><span class="o">=</span><span class="n">protocol</span><span class="p">,</span>
            <span class="n">overrides</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="n">builder</span><span class="p">[</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">b2w_builder</span><span class="o">.</span><span class="n">_data</span>

        <span class="k">return</span> <span class="n">builder</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.get_builder_restart_from_epw_stash">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.get_builder_restart_from_epw_stash">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_builder_restart_from_epw_stash</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">from_epw_stash_folder</span><span class="p">,</span>
            <span class="n">protocol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">overrides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a builder prepopulated with inputs selected according to the chosen protocol.</span>

<span class="sd">        :TODO:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">from_epw_stash_folder</span><span class="p">,</span> <span class="p">(</span><span class="n">orm</span><span class="o">.</span><span class="n">RemoteData</span><span class="p">,</span> <span class="n">orm</span><span class="o">.</span><span class="n">RemoteStashFolderData</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The `from_epw_stash_folder` must be a `RemoteData` or `RemoteStashFolderData` node.&#39;</span><span class="p">)</span>

        <span class="n">structure</span> <span class="o">=</span> <span class="n">from_epw_stash_folder</span><span class="o">.</span><span class="n">creator</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">from_epw_stash_folder</span><span class="o">.</span><span class="n">creator</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">code</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">structure</span><span class="p">,</span> <span class="n">protocol</span><span class="p">)</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_protocol_inputs</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">overrides</span><span class="p">)</span>


        <span class="n">builder</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_builder</span><span class="p">()</span>

        <span class="n">builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">)</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">aiida_quantumespresso.workflows.protocols.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">recursive_merge</span>

        <span class="k">for</span> <span class="n">epw_class</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="n">EpwA2fWorkChain</span><span class="p">,</span>
            <span class="n">EpwIsoWorkChain</span><span class="p">,</span>
            <span class="n">EpwAnisoWorkChain</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">epw_namespace</span> <span class="o">=</span> <span class="n">epw_class</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span>

            <span class="n">overrides_intp</span> <span class="o">=</span> <span class="n">recursive_merge</span><span class="p">(</span>
                <span class="n">epw_class</span><span class="o">.</span><span class="n">get_protocol_overrides</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default_inputs&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">epw_namespace</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">epw_namespace</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">epw_namespace</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">epw_builder</span> <span class="o">=</span> <span class="n">EpwBaseWorkChain</span><span class="o">.</span><span class="n">get_builder_from_protocol</span><span class="p">(</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="n">overrides</span><span class="o">=</span><span class="n">overrides_intp</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

            <span class="n">builder</span><span class="p">[</span><span class="n">epw_namespace</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">)</span>
            <span class="n">builder</span><span class="p">[</span><span class="n">epw_namespace</span><span class="p">]</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
            <span class="n">builder</span><span class="p">[</span><span class="n">epw_namespace</span><span class="p">][</span><span class="n">epw_namespace</span><span class="p">]</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">epw_builder</span><span class="o">.</span><span class="n">_data</span>

        <span class="n">builder</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_A2F_NAMESPACE</span><span class="p">][</span><span class="bp">cls</span><span class="o">.</span><span class="n">_A2F_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">from_epw_stash_folder</span>

        <span class="n">builder</span><span class="o">.</span><span class="n">interpolation_distances</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interpolation_distances&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">convergence_threshold</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;convergence_threshold&#39;</span><span class="p">])</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">always_run_final</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;always_run_final&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">clean_workdir</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;clean_workdir&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">builder</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.get_builder_from_protocol">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.get_builder_from_protocol">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_builder_from_protocol</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">codes</span><span class="p">,</span>
            <span class="n">structure</span><span class="p">,</span>
            <span class="n">protocol</span><span class="o">=</span><span class="s1">&#39;moderate&#39;</span><span class="p">,</span>
            <span class="n">overrides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a builder prepopulated with inputs selected according to the chosen protocol.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_protocol_inputs</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">overrides</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">structure</span><span class="p">,</span> <span class="n">protocol</span><span class="p">)</span>

        <span class="n">builder</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_builder</span><span class="p">()</span>

        <span class="n">b2w_builder</span> <span class="o">=</span> <span class="n">EpwB2WWorkChain</span><span class="o">.</span><span class="n">get_builder_from_protocol</span><span class="p">(</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">overrides</span><span class="o">=</span><span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="n">builder</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">b2w_builder</span><span class="o">.</span><span class="n">_data</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">epw_namespace</span><span class="p">,</span> <span class="n">epw_workchain_class</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_BANDS_NAMESPACE</span><span class="p">,</span> <span class="n">EpwBandsWorkChain</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_A2F_NAMESPACE</span><span class="p">,</span> <span class="n">EpwA2fWorkChain</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span><span class="p">,</span> <span class="n">EpwIsoWorkChain</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ANISO_NAMESPACE</span><span class="p">,</span> <span class="n">EpwAnisoWorkChain</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="n">epw_builder</span> <span class="o">=</span> <span class="n">epw_workchain_class</span><span class="o">.</span><span class="n">get_builder_from_protocol</span><span class="p">(</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="n">overrides</span><span class="o">=</span><span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">epw_namespace</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

            <span class="n">epw_builder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">epw_workchain_class</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">)</span>

            <span class="n">builder</span><span class="p">[</span><span class="n">epw_namespace</span><span class="p">]</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">epw_builder</span><span class="o">.</span><span class="n">_data</span>

            <span class="c1"># builder.structure = structure</span>
            <span class="c1"># builder.qfpoints_distance = orm.Float(inputs.get(&#39;qfpoints_distance&#39;, None))</span>
            <span class="c1"># builder.kfpoints_factor = orm.Float(inputs.get(&#39;kfpoints_factor&#39;, None))</span>

        <span class="n">builder</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">interpolation_distances</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interpolation_distances&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">convergence_threshold</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;convergence_threshold&#39;</span><span class="p">])</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">always_run_final</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;always_run_final&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">clean_workdir</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;clean_workdir&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">builder</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.validate_inputs">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.validate_inputs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;interpolation_distances&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">interpolation_distances</span><span class="p">,</span> <span class="n">orm</span><span class="o">.</span><span class="n">List</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">interpolation_distances</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">convergence_threshold</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_codes</span><span class="o">.</span><span class="n">ERROR_CONVERGENCE_THRESHOLD_NOT_SPECIFIED</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The `interpolation_distances` must be a list with at least one element.&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">EpwA2fWorkChain</span><span class="o">.</span><span class="n">_INTP_NAMESPACE</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The `a2f` must be provided as an input port.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;convergence_threshold&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The `convergence_threshold` must not be provided if the `interpolation_distances` is not provided.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.setup">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.setup">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup steps, i.e. initialise context variables.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A2F_NAMESPACE</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs_a2f</span> <span class="o">=</span> <span class="n">AttributeDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exposed_inputs</span><span class="p">(</span><span class="n">EpwA2fWorkChain</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_A2F_NAMESPACE</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs_iso</span> <span class="o">=</span> <span class="n">AttributeDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exposed_inputs</span><span class="p">(</span><span class="n">EpwIsoWorkChain</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs_aniso</span> <span class="o">=</span> <span class="n">AttributeDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exposed_inputs</span><span class="p">(</span><span class="n">EpwAnisoWorkChain</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ANISO_NAMESPACE</span><span class="p">))</span>

        <span class="k">if</span> <span class="s1">&#39;interpolation_distances&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Will check convergence&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">interpolation_distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interpolation_distances&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_list</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">interpolation_distances</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">final_a2f</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">allen_dynes_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">is_converged</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.should_run_b2w">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.should_run_b2w">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">should_run_b2w</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the b2w workflow should continue or not.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.run_b2w">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.run_b2w">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_b2w</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the b2w workflow.&quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">AttributeDict</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exposed_inputs</span><span class="p">(</span>
                <span class="n">EpwB2WWorkChain</span><span class="p">,</span>
                <span class="n">namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">inputs</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">inputs</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">call_link_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span>
        <span class="n">workchain_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">EpwB2WWorkChain</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;launching `b2w` with PK </span><span class="si">{</span><span class="n">workchain_node</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ToContext</span><span class="p">(</span><span class="n">workchain_b2w</span><span class="o">=</span><span class="n">workchain_node</span><span class="p">)</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.inspect_b2w">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.inspect_b2w">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">inspect_b2w</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inspect the b2w workflow.&quot;&quot;&quot;</span>
        <span class="n">b2w_workchain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">workchain_b2w</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">b2w_workchain</span><span class="o">.</span><span class="n">is_finished_ok</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;`epw.x` failed with exit status </span><span class="si">{</span><span class="n">b2w_workchain</span><span class="o">.</span><span class="n">exit_status</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_codes</span><span class="o">.</span><span class="n">ERROR_SUB_PROCESS_B2W</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">out_many</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exposed_outputs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">workchain_b2w</span><span class="p">,</span>
                <span class="n">EpwB2WWorkChain</span><span class="p">,</span>
                <span class="n">namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.should_run_bands">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.should_run_bands">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">should_run_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the bands workflow should continue or not.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BANDS_NAMESPACE</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.run_bands">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.run_bands">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the bands workflow.&quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">AttributeDict</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exposed_inputs</span><span class="p">(</span>
                <span class="n">EpwBandsWorkChain</span><span class="p">,</span>
                <span class="n">namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_BANDS_NAMESPACE</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">inputs</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">inputs</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">call_link_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BANDS_NAMESPACE</span>
        <span class="n">workchain_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">EpwBandsWorkChain</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;launching `bands` with PK </span><span class="si">{</span><span class="n">workchain_node</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ToContext</span><span class="p">(</span><span class="n">workchain_bands</span><span class="o">=</span><span class="n">workchain_node</span><span class="p">)</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.inspect_bands">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.inspect_bands">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">inspect_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inspect the bands workflow.&quot;&quot;&quot;</span>
        <span class="n">bands_workchain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">workchain_bands</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bands_workchain</span><span class="o">.</span><span class="n">is_finished_ok</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;`epw.x` failed with exit status </span><span class="si">{</span><span class="n">bands_workchain</span><span class="o">.</span><span class="n">exit_status</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_codes</span><span class="o">.</span><span class="n">ERROR_SUB_PROCESS_BANDS</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">out_many</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exposed_outputs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">workchain_bands</span><span class="p">,</span>
                <span class="n">EpwBandsWorkChain</span><span class="p">,</span>
                <span class="n">namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_BANDS_NAMESPACE</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.prepare_intp">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.prepare_intp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_intp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare the inputs for the interpolation workflow.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s1">&#39;interpolation_distances&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;No interpolation distances provided, will not do interpolation.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs_a2f</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_A2F_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">epw</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get_dict</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">should_run_b2w</span><span class="p">():</span>
            <span class="n">b2w_workchain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">workchain_b2w</span>

            <span class="n">b2w_parameters</span> <span class="o">=</span> <span class="n">b2w_workchain</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_B2W_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">epw</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get_dict</span><span class="p">()</span>

            <span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">b2w_workchain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">epw</span><span class="o">.</span><span class="n">remote_folder</span>

            <span class="k">for</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blocked_keywords</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">b2w_parameters</span><span class="p">[</span><span class="n">namespace</span><span class="p">]:</span>
                    <span class="n">parameters</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">keyword</span><span class="p">]</span> <span class="o">=</span> <span class="n">b2w_parameters</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">keyword</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs_a2f</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_A2F_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">parent_folder_epw</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs_a2f</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_A2F_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">epw</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.should_run_conv">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.should_run_conv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">should_run_conv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the conv loop should continue or not.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s1">&#39;interpolation_distances&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">prev_allen_dynes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">a2f_conv</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">output_parameters</span><span class="p">[</span><span class="s1">&#39;Allen_Dynes_Tc&#39;</span><span class="p">]</span>
            <span class="n">new_allen_dynes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">a2f_conv</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">output_parameters</span><span class="p">[</span><span class="s1">&#39;Allen_Dynes_Tc&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">is_converged</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">prev_allen_dynes</span> <span class="o">-</span> <span class="n">new_allen_dynes</span><span class="p">)</span> <span class="o">/</span> <span class="n">new_allen_dynes</span>
                <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">convergence_threshold</span><span class="o">.</span><span class="n">value</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Checking convergence: old </span><span class="si">{</span><span class="n">prev_allen_dynes</span><span class="si">}</span><span class="s1">; new </span><span class="si">{</span><span class="n">new_allen_dynes</span><span class="si">}</span><span class="s1"> -&gt; Converged = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">is_converged</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;Not enough data to check convergence.&#39;</span><span class="p">)</span>

        <span class="c1">## TODO: If Allen-Dynes Tc is converged, clean the remote folder:</span>
        <span class="c1">## rm out/aiida.ephmat/*, out/aiida.epwmatwp,</span>
        <span class="c1">## Leaving only the final a2f calculation for later use.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">is_converged</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs_iso</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">a2f_conv</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">remote_folder</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">interpolation_distances</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">is_converged</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">always_run_final</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs_iso</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">a2f_conv</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">remote_folder</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;Allen-Dynes Tc is not converged, but will run the following workchains!.&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_codes</span><span class="o">.</span><span class="n">ERROR_CONVERGENCE_NOT_REACHED</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.run_conv">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.run_conv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_conv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the ``restart`` EPW calculation for the current interpolation distance.&quot;&quot;&quot;</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs_a2f</span>
        <span class="n">inputs</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">inputs</span><span class="o">.</span><span class="n">a2f</span><span class="o">.</span><span class="n">qfpoints_distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">interpolation_distances</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="n">inputs</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">call_link_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_CONV_NAMESPACE</span>
        <span class="n">workchain_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">EpwA2fWorkChain</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;launching interpolation `epw` with PK </span><span class="si">{</span><span class="n">workchain_node</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s1"> [qfpoints_distance = </span><span class="si">{</span><span class="n">inputs</span><span class="o">.</span><span class="n">a2f</span><span class="o">.</span><span class="n">qfpoints_distance</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ToContext</span><span class="p">(</span><span class="n">a2f_conv</span><span class="o">=</span><span class="n">append_</span><span class="p">(</span><span class="n">workchain_node</span><span class="p">))</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.inspect_conv">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.inspect_conv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">inspect_conv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify that the conv workflow finished successfully.&quot;&quot;&quot;</span>
        <span class="n">a2f_workchain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">a2f_conv</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">a2f_workchain</span><span class="o">.</span><span class="n">is_finished_ok</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;`epw.x` failed with exit status </span><span class="si">{</span><span class="n">a2f_workchain</span><span class="o">.</span><span class="n">exit_status</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">a2f_conv</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">## TODO: Use better way to get the mesh</span>
            <span class="n">a2f_calculation</span> <span class="o">=</span> <span class="n">a2f_workchain</span><span class="o">.</span><span class="n">called_descendants</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a2f_calculation</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">qfpoints</span><span class="o">.</span><span class="n">get_kpoints_mesh</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Allen-Dynes: </span><span class="si">{</span><span class="n">a2f_workchain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">output_parameters</span><span class="p">[</span><span class="s1">&#39;Allen_Dynes_Tc&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">mesh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find Allen-Dynes temperature in parsed output parameters!&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.should_run_a2f">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.should_run_a2f">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">should_run_a2f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the a2f workflow should continue or not.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_A2F_NAMESPACE</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span>
            <span class="ow">and</span>
            <span class="s1">&#39;interpolation_distances&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.run_a2f">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.run_a2f">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_a2f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the a2f workflow.&quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs_a2f</span>
        <span class="n">inputs</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">structure</span>

        <span class="n">inputs</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">call_link_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A2F_NAMESPACE</span>
        <span class="n">workchain_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">EpwA2fWorkChain</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ToContext</span><span class="p">(</span><span class="n">workchain_a2f</span><span class="o">=</span><span class="n">workchain_node</span><span class="p">)</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.inspect_a2f">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.inspect_a2f">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">inspect_a2f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inspect the a2f workflow.&quot;&quot;&quot;</span>
        <span class="n">a2f_workchain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">workchain_a2f</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">a2f_workchain</span><span class="o">.</span><span class="n">is_finished_ok</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;`epw.x` failed with exit status </span><span class="si">{</span><span class="n">a2f_workchain</span><span class="o">.</span><span class="n">exit_status</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_codes</span><span class="o">.</span><span class="n">ERROR_SUB_PROCESS_A2F</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">out_many</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exposed_outputs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">workchain_a2f</span><span class="p">,</span>
                <span class="n">EpwA2fWorkChain</span><span class="p">,</span>
                <span class="n">namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_A2F_NAMESPACE</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs_iso</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">a2f_workchain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">remote_folder</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.should_run_iso">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.should_run_iso">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">should_run_iso</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the iso workflow should continue or not.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">Allen_Dynes_Tc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs_iso</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span><span class="o">.</span><span class="n">creator</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">output_parameters</span><span class="p">[</span><span class="s1">&#39;Allen_Dynes_Tc&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">Allen_Dynes_Tc</span> <span class="o">&lt;</span> <span class="n">EpwIsoWorkChain</span><span class="o">.</span><span class="n">_MIN_TEMP</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_codes</span><span class="o">.</span><span class="n">ERROR_ISOTROPIC_TC_TOO_LOW</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">Allen_Dynes_Tc</span> <span class="o">=</span> <span class="n">Allen_Dynes_Tc</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.run_iso">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.run_iso">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_iso</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the iso workflow.&quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs_iso</span>
        <span class="n">inputs</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span>
        <span class="n">a2f_parameters</span> <span class="o">=</span> <span class="n">parent_folder_epw</span><span class="o">.</span><span class="n">creator</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get_dict</span><span class="p">()</span>

        <span class="n">inputs</span><span class="o">.</span><span class="n">estimated_Tc_iso</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">Allen_Dynes_Tc</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">)</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">epw</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get_dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blocked_keywords</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">a2f_parameters</span><span class="p">[</span><span class="n">namespace</span><span class="p">]:</span>
                <span class="n">parameters</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">keyword</span><span class="p">]</span> <span class="o">=</span> <span class="n">a2f_parameters</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">keyword</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">_params</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restart_from_ephmat</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">_params</span><span class="p">:</span>
                <span class="n">parameters</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">inputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">epw</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

        <span class="n">inputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">qfpoints_distance</span> <span class="o">=</span> <span class="n">parent_folder_epw</span><span class="o">.</span><span class="n">creator</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">qfpoints_distance</span>
        <span class="n">inputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">kfpoints_factor</span> <span class="o">=</span> <span class="n">parent_folder_epw</span><span class="o">.</span><span class="n">creator</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">kfpoints_factor</span>

        <span class="n">inputs</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">call_link_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span>
        <span class="n">workchain_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">EpwIsoWorkChain</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ToContext</span><span class="p">(</span><span class="n">workchain_iso</span><span class="o">=</span><span class="n">workchain_node</span><span class="p">)</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.inspect_iso">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.inspect_iso">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">inspect_iso</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inspect the iso workflow.&quot;&quot;&quot;</span>
        <span class="n">iso_workchain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">workchain_iso</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">iso_workchain</span><span class="o">.</span><span class="n">is_finished_ok</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;`epw.x` failed with exit status </span><span class="si">{</span><span class="n">iso_workchain</span><span class="o">.</span><span class="n">exit_status</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_codes</span><span class="o">.</span><span class="n">ERROR_SUB_PROCESS_ISO</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">out_many</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exposed_outputs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">workchain_iso</span><span class="p">,</span>
                <span class="n">EpwIsoWorkChain</span><span class="p">,</span>
                <span class="n">namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ISO_NAMESPACE</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs_aniso</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ANISO_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">iso_workchain</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">remote_folder</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.should_run_aniso">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.should_run_aniso">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">should_run_aniso</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the aniso workflow should continue or not.&quot;&quot;&quot;</span>

        <span class="n">Tc_iso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs_aniso</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ANISO_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span><span class="o">.</span><span class="n">creator</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">Tc_iso</span><span class="o">.</span><span class="n">value</span>

        <span class="k">if</span> <span class="n">Tc_iso</span> <span class="o">&lt;</span> <span class="n">EpwAnisoWorkChain</span><span class="o">.</span><span class="n">_MIN_TEMP</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_codes</span><span class="o">.</span><span class="n">ERROR_ANISOTROPIC_TC_TOO_LOW</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">Tc_iso</span> <span class="o">=</span> <span class="n">Tc_iso</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ANISO_NAMESPACE</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.run_aniso">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.run_aniso">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_aniso</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the aniso workflow.&quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">inputs_aniso</span>
        <span class="n">inputs</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">inputs</span><span class="o">.</span><span class="n">estimated_Tc_aniso</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">Tc_iso</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)</span>

        <span class="n">parent_folder_epw</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ANISO_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">parent_folder_epw</span>
        <span class="n">iso_parameters</span> <span class="o">=</span> <span class="n">parent_folder_epw</span><span class="o">.</span><span class="n">creator</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get_dict</span><span class="p">()</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">aniso</span><span class="o">.</span><span class="n">epw</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get_dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blocked_keywords</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">iso_parameters</span><span class="p">[</span><span class="n">namespace</span><span class="p">]:</span>
                <span class="n">parameters</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">keyword</span><span class="p">]</span> <span class="o">=</span> <span class="n">iso_parameters</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">keyword</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">_params</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restart_from_ephmat</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">_params</span><span class="p">:</span>
                <span class="n">parameters</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">inputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ANISO_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">epw</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

        <span class="n">inputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ANISO_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">qfpoints_distance</span> <span class="o">=</span> <span class="n">parent_folder_epw</span><span class="o">.</span><span class="n">creator</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">qfpoints_distance</span>
        <span class="n">inputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ANISO_NAMESPACE</span><span class="p">]</span><span class="o">.</span><span class="n">kfpoints_factor</span> <span class="o">=</span> <span class="n">parent_folder_epw</span><span class="o">.</span><span class="n">creator</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">kfpoints_factor</span>

        <span class="n">inputs</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">call_link_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ANISO_NAMESPACE</span>
        <span class="n">workchain_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">EpwAnisoWorkChain</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ToContext</span><span class="p">(</span><span class="n">workchain_aniso</span><span class="o">=</span><span class="n">workchain_node</span><span class="p">)</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.inspect_aniso">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.inspect_aniso">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">inspect_aniso</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inspect the aniso workflow.&quot;&quot;&quot;</span>
        <span class="n">aniso_workchain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">workchain_aniso</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">aniso_workchain</span><span class="o">.</span><span class="n">is_finished_ok</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;`epw.x` failed with exit status </span><span class="si">{</span><span class="n">aniso_workchain</span><span class="o">.</span><span class="n">exit_status</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_codes</span><span class="o">.</span><span class="n">ERROR_SUB_PROCESS_ANISO</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">out_many</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exposed_outputs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">workchain_aniso</span><span class="p">,</span>
                <span class="n">EpwAnisoWorkChain</span><span class="p">,</span>
                <span class="n">namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ANISO_NAMESPACE</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="EpwSuperConWorkChain.results">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.results">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TODO&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s1">&#39;a2f_conv&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out_many</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exposed_outputs</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">a2f_conv</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">EpwA2fWorkChain</span><span class="p">,</span>
                    <span class="n">namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_CONV_NAMESPACE</span>
                <span class="p">)</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="EpwSuperConWorkChain.on_terminated">
<a class="viewcode-back" href="../../../api_reference/aiida_supercon.workflows.html#aiida_supercon.workflows.supercon.EpwSuperConWorkChain.on_terminated">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_terminated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean the working directories of all child calculations if `clean_workdir=True` in the inputs.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_terminated</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">clean_workdir</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;remote folders will not be cleaned&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">cleaned_calcs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">called_descendant</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">called_descendants</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">called_descendant</span><span class="p">,</span> <span class="n">orm</span><span class="o">.</span><span class="n">CalcJobNode</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">called_descendant</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">remote_folder</span><span class="o">.</span><span class="n">_clean</span><span class="p">()</span>  <span class="c1"># pylint: disable=protected-access</span>
                    <span class="n">cleaned_calcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">called_descendant</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
                    <span class="k">pass</span>

        <span class="k">if</span> <span class="n">cleaned_calcs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cleaned remote folders of calculations: </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">cleaned_calcs</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>
</div>


</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Marnik Bercx.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>